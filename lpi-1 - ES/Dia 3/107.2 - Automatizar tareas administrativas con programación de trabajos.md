
## Objetivos

- Usar `cron` y `at` para automatizar tareas
- Configurar el acceso a la programación de tareas.
- Comprender variables y formatos de tiempo usados por estas herramientas.
- Utilizar `systemd-run` como alternativa moderna.

---
## 1. Programar trabajos con Cron

`cron` ejecuta tareas de forma recurrente usando los llamados **crontabs**.
### Comando para editar el crontab de usuario:

```bash
crontab -e
```
### Formato:

```bash
# min hora día_mes mes día_semana comando
  0    2     *       *       1       /usr/local/bin/respaldo.sh
```
### Atajos de tiempo:

```bash
@reboot     # Al iniciar el sistema
@hourly     # Cada hora
@daily      # Cada día
@weekly     # Cada semana
@monthly    # Cada mes
@yearly     # Cada año
```

---
## 2. Crontabs de sistema

Se configuran en archivos como `/etc/crontab` o `/etc/cron.d/`.

Ejemplo:

```bash
30 01 * * * root /root/script.sh >> /var/log/salida.log 2>> /var/log/errores.log
```

---
## 3. Variables comunes en crontab

```bash
MAILTO="admin@example.com"   # Dónde enviar la salida
HOME=/home/usuario           # Ruta desde donde se ejecuta
SHELL=/bin/bash              # Intérprete usado
PATH=/usr/bin:/bin:/usr/local/bin
```

---
## 4. Configurar el acceso
- `/etc/cron.allow`: Lista blanca de usuarios permitidos.
- `/etc/cron.deny`: Lista negra de usuarios denegados.

---
## 5. Programar tareas únicas con `at`

```bash
at 10:00 AM Jan 01
at> /home/usuario/foo.sh
at> <Ctrl+D>
```
### Revisar y borrar tareas:

```bash
atq        # Ver tareas
atrm 5     # Borrar tarea con ID 5
```

---
## 6. Alternativa: `systemd-run`

```bash
sudo systemd-run --on-calendar="2025-07-01 08:30" /home/usuario/miscript.sh
```

---
## Ejercicios Guiados

### 1. Crear una tarea que se ejecute todos los lunes a las 3:00 am:

```bash
crontab -e
0 3 * * 1 /home/usuario/limpieza.sh
```
### 2. Programar una tarea única con `at`:

```bash
at now +10 minutes
at> echo "Prueba de tarea" >> /tmp/salida.txt
at> <Ctrl+D>
```
### 3. Eliminar una tarea programada con `at`:

```bash
atrm 3  # Suponiendo que 3 es el ID
```
### 4. Crear tarea usando `systemd-run`:

```bash
sudo systemd-run --on-calendar="2025-08-01 10:00" echo "Backup lanzado"
```

---
## Actividad Final

Diseñar 3 automatizaciones utilizando `cron`, `at` o `systemd-run`:

1. **Copias de seguridad diarias a las 2:00 am usando cron**

```bash
crontab -e
0 2 * * * /home/usuario/backup.sh >> /var/log/backup.log 2>&1
```

2. **Actualizar sistema mañana a las 8:00 am con `at`**

```bash
at 08:00 AM tomorrow
at> sudo apt update && sudo apt upgrade -y
at> <Ctrl+D>
```

3. **Ejecutar script una vez con `systemd-run` el próximo lunes a las 9:00 am**

```bash
sudo systemd-run --on-calendar="Mon 09:00" /usr/local/bin/tarea.sh
```

---
## Recursos adicionales

- `man crontab`
- `man at`
- `man systemd-run`